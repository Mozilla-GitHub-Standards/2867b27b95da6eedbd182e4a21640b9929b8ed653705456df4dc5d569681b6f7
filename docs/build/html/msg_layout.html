

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Detailed message layout &mdash; metlog-psutils 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="metlog-psutils 0.1 documentation" href="index.html" />
    <link rel="next" title="API documentation" href="api/psutil_plugin.html" />
    <link rel="prev" title="Configuration" href="config.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api/psutil_plugin.html" title="API documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">metlog-psutils 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="detailed-message-layout">
<h1>Detailed message layout<a class="headerlink" href="#detailed-message-layout" title="Permalink to this headline">¶</a></h1>
<p>The plugin will only send the process details that you explicitly
ask for. These details are formatted as JSON blobs that are formatted
such that a statsd message can be generated on the metlog server side.
The following is an example that creates network, cpu, io, memory and
thread statistics.</p>
<p>Each statsd messages is namespaced with <cite>psutil.&lt;group&gt;.&lt;hostname&gt;.&lt;pid&gt;</cite></p>
<p>Note that hostnames have periods replaced with underscore characters
so that statsd and graphite will properly namespace the messages.</p>
<p>Open sockets are represented with a two part key.</p>
<p>The key is comprised of:</p>
<blockquote>
<div><ul class="simple">
<li>the host and port of the socket on the server side.  Note that the
IP address has periods converted into underscores.</li>
<li>the TCP connection status</li>
</ul>
</div></blockquote>
<p>For the following examples, the hostname of the server is
<cite>MyHostName</cite> and the process ID of the parent process is 9973.</p>
<div class="section" id="open-sockets">
<h2>Open sockets<a class="headerlink" href="#open-sockets" title="Permalink to this headline">¶</a></h2>
<p>An example of a server socket that is listening</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.net.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;127_0_0_1:50007.LISTEN&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>This will then get serialized into a statsd message in form of:</p>
<div class="highlight-python"><pre>psutil.net.MyHostName.9973.127_0_0_1:50007.LISTEN|1|1</pre>
</div>
</div>
<div class="section" id="cpu-time">
<h2>CPU time<a class="headerlink" href="#cpu-time" title="Permalink to this headline">¶</a></h2>
<p>CPU information for seconds in user space, seconds in kernel space,
and percentage of CPU time used is represented as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.cpu.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;user&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.12</span> <span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.cpu.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;sys&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.02</span> <span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.cpu.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;pcnt&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="p">}</span>
</pre></div>
</div>
<p>These are formatted into the following statsd messages:</p>
<div class="highlight-python"><pre>psutil.cpu.MyHostName.9973.user|0.12
psutil.cpu.MyHostName.9973.sys|0.02
psutil.cpu.MyHostName.9973.pcnt|0.0</pre>
</div>
</div>
<div class="section" id="i-o-counters">
<h2>I/O counters<a class="headerlink" href="#i-o-counters" title="Permalink to this headline">¶</a></h2>
<p>I/O metrics provide bytes read, written and the number of system calls
used for read and write operations.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.io.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;read_bytes&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.io.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;write_bytes&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.io.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;read_count&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3115</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.io.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;write_count&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">5434</span><span class="p">}</span>
</pre></div>
</div>
<p>This will then get serialized into a statsd message in form of:</p>
<div class="highlight-python"><pre>psutil.io.MyHostName.9973.read_bytes|50
psutil.io.MyHostName.9973.write_bytes|200
psutil.io.MyHostName.9973.write_count|3115
psutil.io.MyHostName.9973.write_bytes|5434</pre>
</div>
</div>
<div class="section" id="memory-usage">
<h2>Memory Usage<a class="headerlink" href="#memory-usage" title="Permalink to this headline">¶</a></h2>
<p>Memory stats provide percentage of memory used as well as RSS and VMS
usage.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.meminfo.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;pcnt&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">2.193876346582101</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.meminfo.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;rss&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">11415552</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.meminfo.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;vms&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">52461568</span><span class="p">}</span>
</pre></div>
</div>
<p>This will then get serialized into a statsd message in form of:</p>
<div class="highlight-python"><pre>psutil.meminfo.MyHostName.9973.pcnt|2.193876346582101
psutil.meminfo.MyHostName.9973.rss|11415552
psutil.meminfo.MyHostName.9973.vms|52461568</pre>
</div>
</div>
<div class="section" id="thread-level-cpu-usage">
<h2>Thread level CPU usage<a class="headerlink" href="#thread-level-cpu-usage" title="Permalink to this headline">¶</a></h2>
<p>Thread level CPU usage adds the thread id as a prefix to the key.
statsd is provided with CPU usage for user space and kernel space in
seconds.  The key is prefixed with the thread id so that statistics
per thread per process can be monitored. In the following example, CPU
stats for thread 17177 are monitored.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.thread.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;17177.sys&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">}</span>

<span class="p">{</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> <span class="s">&#39;psutil.thread.MyHostName.9973&#39;</span><span class="p">,</span>
 <span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;17177.user&#39;</span><span class="p">,</span>
 <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.13</span><span class="p">}</span>
</pre></div>
</div>
<p>This will then get serialized into a statsd message in form of:</p>
<div class="highlight-python"><pre>psutil.thread.MyHostName.9973.17177.sys|0.02
psutil.thread.MyHostName.9973.17177.user|0.13</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Detailed message layout</a><ul>
<li><a class="reference internal" href="#open-sockets">Open sockets</a></li>
<li><a class="reference internal" href="#cpu-time">CPU time</a></li>
<li><a class="reference internal" href="#i-o-counters">I/O counters</a></li>
<li><a class="reference internal" href="#memory-usage">Memory Usage</a></li>
<li><a class="reference internal" href="#thread-level-cpu-usage">Thread level CPU usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="config.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api/psutil_plugin.html"
                        title="next chapter">API documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/msg_layout.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api/psutil_plugin.html" title="API documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             >previous</a> |</li>
        <li><a href="index.html">metlog-psutils 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Victor Ng.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>